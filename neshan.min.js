//Developer: Maher Ashori
//Email: maher.ashori@gmail.com
//Github: https://github.com/maherAshori/Neshan-Map
//version: 0.0.1
var app = angular.module("Neshan", []); app.provider("neshan", function () { var a = {}; this.configs = function (b) { a = b }, this.$get = function () { return a } }), app.directive("neshan", ["$timeout", "$http", "neshan", function (a, b, c) { return { template: "<div class=\"map-wrapper\"><form ng-if=\"activeSearchBox\" ng-submit=\"startSearching()\" class=\"input-group map-search\" ng-class='{\"on\": results.length > 0}' dir=\"ltr\"><input type=\"search\" placeholder=\"{{searchPlaceholderText}}\" ng-model=\"output.searchTerm\" class=\"form-control\" ng-focus=\"inputFocus()\" /><div class=\"search-result\"><ul class=\"list-group p-0 m-0\"><li class=\"list-group-item\" ng-repeat=\"item in results\" ng-click=\"setView(item)\"><div class=\"clearfix d-block text-right\"><h6 class=\"float-right m-0 text-primary\">{{item.title}}</h6><h6 class=\"float-left m-0 text-success\">{{item.region}}</h6></div><div class=\"clearfix d-block text-right text-muted\"><small class=\"m-0\">{{item.neighbourhood}}</small></div><div class=\"clearfix d-block text-right text-muted\"><small>{{item.address}}</small></div></li></ul></div></form><div id=\"{{mapId}}\" class=\"neshan-container\"></div></div>", scope: { output: "=", mapId: "@?", addMarker: "=?", watchMapType: "=?" }, link: function (d) { return d.searchPlaceholderText = c.searchPlaceholderText, d.mapId || (d.mapId = "map"), c.searchPlaceholderText || (d.searchPlaceholderText = "Place"), c.zoom || (c.zoom = 12), angular.isUndefined(c.zoomControl) && (c.zoomControl = !0), c.timeoutReady || (c.timeoutReady = 0), c.search && !c.serviceKey ? (console.error("serviceKey is undefined! search not work ... more information: https://neshan.org"), !1) : void a(function () { var a = new L.Map(d.mapId, { key: c.mapKey, poi: c.poi, traffic: c.traffic, center: c.defaultCenter, zoom: c.zoom, zoomControl: c.zoomControl }); c.mapType ? a.setMapType(c.mapType) : a.setMapType("standard-day"), d.$watch("watchMapType", function (b) { null != b && a.setMapType(b) }, !0), d.output = {}; var f, g, h, i = []; if (d.addMarker && (h = new L.Marker([d.addMarker[0], d.addMarker[1]]).addTo(a)), c.activeMarker && a.on("click", function (b) { d.results = [], c.singleMarker && h && a.removeLayer(h), h = new L.Marker([b.latlng.lat, b.latlng.lng]).addTo(a), c.singleMarker ? (f = b.latlng.lat, g = b.latlng.lng, d.output.lat = f, d.output.lng = g) : (i.push({ lat: b.latlng.lat, lng: b.latlng.lng }), d.output.latLag = i), d.$apply() }), c.search && c.serviceKey) { d.activeSearchBox = !0; var j = [], k = []; d.startSearching = function () { var a = { term: d.output.searchTerm, lat: void 0 === f ? c.defaultCenter[0] : f, lng: void 0 === g ? c.defaultCenter[1] : g }; b({ method: "GET", url: "https://api.neshan.org/v1/search", params: a, headers: { "Api-Key": c.serviceKey } }).then(function (a) { if (200 === a.status) { const b = a.data; d.results = b.items, k = angular.copy(b.items), j = angular.copy(d.output.searchTerm) } }) }, d.inputFocus = function () { d.output.searchTerm === j && (d.results = k) }, d.setView = function (b) { a.setView(new L.LatLng(b.location.y, b.location.x), a.getZoom()), h && a.removeLayer(h), h = new L.Marker([b.location.y, b.location.x]).addTo(a), d.results = [] } } }, d.timeoutReady) } } }]);